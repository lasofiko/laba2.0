Лабораторная работа 2

Задача: Создать упрощенную командную оболочку для работы с файлами

Используемые модули Python: os, datetime, shutil, unittest,tempfile

Ограничения и правила:

1. При ошибках выводится описание проблемы и она тоже сохраняется в журнал

2. В названиях файлов и папок нельзя использовать пробелы и кавычки

3. Неизвестные дополнительные параметры игнорируются системой

Чему научилась:

1. Управление файлами и папками через Python (os, shutil)

2. Корректная обработка сбоев и непредвиденных ситуаций

3. Ведение журнала операций с указанием времени выполнения

4. Приведение путей файлов к стандартному формату

5. Работа с вложенными папками и их содержимым

Принцип работы программы:

Пользователь вводит команду (или "exit" для выхода)

Введенная строка разделяется на отдельные части

Выполняется обработка команд:

Доступные команды:

ls - отображение содержимого папки

Без указания пути показывает текущую директорию

Не предусмотрено использование команды '-l'

cd - перейти в другую папку

cd .. - вернуться назад
cd ~ - перейти в домашнюю папку

cat - просмотр содержимого файла

Проверяет, что файл существует и не является папкой

cp - скопировать файл/папку

Проверяет наличие исходного объекта

mv - переместить или переименовать

Проверяет существование исходного объекта

rm - удаление файлов и папок

zip <archive>          - создание ZIP

unzip <archive>        - распаковка ZIP

tar <archive>          - создание TAR.GZ

untar <archive>        - распаковка TAR.GZ

Защита от удаления системных папок (/, ..)

Типы обрабатываемых ошибок:

FileNotFoundError - файл не существует

PermissionError - нет прав доступа

IsADirectoryError - ожидался файл, но найдена папка


Запуск программы:

py -m src.main

Запуск проверочных тестов:

py -m unittest discover tests

Завершение работы:

exit

 Работа  zip:
shutil.make_archive()
Первый параметр: a.replace(".zip", "")
Удаляет расширение ".zip" из имени архива, если оно есть
Это нужно чтобы избежать двойного расширения (например, "backup.zip.zip")
Второй параметр: 'zip'
Формат архива (ZIP)
Третий параметр: '.'
текущая папка
Будет заархивировано все содержимое текущей директории

принцип работы make_archive 
функция создает архив с именем (параметр).(формат)
если а=(параметр) -> архив (параметр).(формат)
если а=(параметр).(формат) -> архив (параметр).(формат)

with- автоматически закрывает архив после работы 

 Рaбота с cat:
open(p, 'r', encoding='utf-8') - открывает файл для чтения:
'r' - режим чтения (read)
encoding='utf-8' - кодировка для поддержки русских символов
pt.read() - читает ВЕСЬ файл в строку
print(s) - выводит содержимое файла
with open() as - контекстный менеджер (автоматически закрывает файл)

Работа с  cp:

Для папок:
os.path.isdir(fr) - проверяет, является ли источник директорией
shutil.copytree(fr, t) - рекурсивно копирует всю папку со всем содержимым
Для файлов:
shutil.copy2(fr, t) - копирует файл с сохранением метаданных

разница
shutil.copy2(fr, t) - для файлов:
Копирует содержимое файла
Сохраняет метаданные: время создания, время изменения, права доступа
Если t - директория, файл копируется с исходным именем

shutil.copytree(fr, t) - для папок:
Рекурсивно копирует всю структуру папок
Копирует все файлы и поддиректории
Сохраняет структуру каталогов и метаданные
Целевая папка 

Работа с lg:

datetime.now() - получает текущие дату и время
strftime('%Y-%m-%d %H:%M:%S') - форматирует время в читаемый вид:
%Y - год (4 цифры)
%m - месяц (2 цифры)
%d - день (2 цифры)
%H - час (24-часовой формат)
%M - минуты
%S - секунды

'shell.log' - имя файла журнала
'a' - режим открытия (append - добавление в конец)
'utf-8' - кодировка для поддержки русских символов
with open() as - контекстный менеджер (автоматически закрывает файл)
log.write(s + '\


Тесты:

unittest - фреймворк для тестирования
tempfile - для создания временных файлов/папок
shutil - для операций с файлами (удаление папок)
StringIO - для перехвата вывода в консоль
sys.path.append('src') - чтобы импортировать модули из папки src

tearDown - очистка после каждого теста

unittest.main(verbosity=2)  # Запускает все тесты с подробным выводом
